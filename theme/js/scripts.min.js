/*! django-girls-events - v0.0.0 - 2015-09-14
* Copyright (c) 2015 ; Licensed  */
var pinFactory=function(a){var b="medium",c="heart",d="Point";return{type:"Feature",geometry:{type:d,coordinates:a.coordinates},properties:{id:a.id,title:a.title,description:a.description,"marker-size":b,"marker-color":a.color,"marker-symbol":c}}},collectionFactory=function(){return{type:"FeatureCollection",features:[]}},eventService=function(){var a="data/events.json";this.getEvents=function(){var b=[];return $.ajax({url:a,async:!1}).done(function(a){$.each(a,function(a,c){b.push(c)})}),b}},mapService=function(){var a="pk.eyJ1IjoicGdyYW5nZWlybyIsImEiOiJiYzI1ZTViNDI1OTc5M2U0Yzg3MzY4NDNlYmY2OGNjOCJ9.5W7JSJ5qlHO61_j-1NrZuw";this.loadMap=function(){L.mapbox.accessToken=a;var b=L.mapbox.map("map","mapbox.streets").setView([-15,-55],4),c=L.mapbox.featureLayer().addTo(b);return c}},mapRepository=function(){var a=new eventService;this.getPins=function(){var b=collectionFactory();return $.each(a.getEvents(),function(a,c){b.features.push(pinFactory(c))}),b}},eventRepository=function(){var a=new eventService,b=function(a,b){var c=new Date(a.date+"T23:59:00Z"),d=new Date(b.date+"T23:59:00Z");return d>c?1:c>d?-1:0};this.getEvents=function(){var c=a.getEvents();return c.sort(b)}},mapUseCase=function(){var a=new mapService,b=new mapRepository,c=function(){var b=a.loadMap();return b},d=function(a){var c=b.getPins();a.setGeoJSON(c)};this.execute=function(){var a=c();d(a)}},listEventsUseCase=function(){var a=new eventRepository,b=function(){var a=$("#events-template").html();return Handlebars.compile(a)},c=function(a,b){var c=a(b);$("#events-list").html(c)};this.execute=function(){var d=a.getEvents(),e=b();c(e,d)}};$(document).ready(function(){var a=new mapUseCase,b=new listEventsUseCase;a.execute(),b.execute()});